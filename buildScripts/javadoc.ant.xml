<project name="lombok-pg javadoc" basedir=".." default="javadoc">
	<description>
This buildfile is part of lombok-pg. It is responsible for creating javadoc.
	</description>
	
	<path id="build.path">
		<fileset dir="lib/build">
			<include name="**/*.jar" />
		</fileset>
	</path>

	<target name="javadoc" description="Generates the javadoc">
		<delete dir="build/api" quiet="true" />
		<delete dir="build/javadoc" quiet="true" />
		<mkdir dir="build/api" />
		<javadoc destdir="build/api" windowtitle="lombok-pg">
			<classpath refid="build.path" />
			<fileset dir="src/core" defaultexcludes="yes">
				<include name="lombok/**" />
				<exclude name="lombok/ast/**" />
				<exclude name="lombok/core/**" />
			</fileset>
			<link href="http://download.oracle.com/javase/6/docs/api/" />
			<header><![CDATA[<a href='https://github.com/peichhorn/lombok-pg' target='_blank'>lombok-pg</a> - ]]></header>
			<bottom><![CDATA[<i>Copyright &copy; 2010-2011 Philipp Eichhorn, licensed under the <a href='http://www.opensource.org/licenses/mit-license.php'>MIT licence</a>.]]></bottom>
		</javadoc>
		<!-- bugfix for boneheaded javadoc bug where ?is-external=true is inserted before an anchor ref, breaking the anchor ref.
			is-external=true doesn't actually do anything, so, we'll just get rid of it. -->
		<replaceregexp match="\?is-external=true#" replace="#" flags="gi">
			<fileset dir="build/api" includes="**/*.html" />
		</replaceregexp>
		<mkdir dir="build/javadoc" />
		<copy todir="build/javadoc">
			<fileset dir="build/api" includes="**/*.html" />
			<filterchain>
				<linecontainsregexp negate="true">
					<regexp pattern="(Generated by javadoc)|(.META NAME=.date.)" />
				</linecontainsregexp>
			</filterchain>
		</copy>
		<copy todir="build/javadoc">
			<fileset dir="build/api" excludes="**/*.html" />
		</copy>
	</target>
</project>