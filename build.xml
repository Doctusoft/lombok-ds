<project name="lombok-playground" default="dist" xmlns:ivy="antlib:com.zwitserloot.ivyplusplus">
	<description>
This buildfile is part of lombok-pg. It is the main entry point that contains
the common tasks and can be called on to run the main aspects of all the sub-scripts.
	</description>

	<property name="build.compiler" value="javac1.6" />
	<property name="ivy.retrieve.pattern" value="lib/[conf]/[artifact].[ext]" />
	<available file="lib/ivyplusplus.jar" property="ivyplusplus.available" />

	<!-- clean -->
	<target name="clean" description="Removes all generated files.">
		<delete dir="build" quiet="true" />
	</target>
	
	<target name="distclean" depends="clean" description="Deletes everything that this build script has ever generated.">
		<delete dir="lib" quiet="true" />
		<delete dir="dist" quiet="true" />
		<delete file=".project" quiet="true" />
		<delete file=".classpath" quiet="true" />
		<delete dir=".settings" quiet="true" />
	</target>
	
	<!-- compile -->
	<target name="compile" depends="ensureBuildDeps" description="Compiles the code.">
		<ivy:compile destdir="build/lombok-pg" source="1.6" target="1.6" includeantruntime="false">
			<src path="src/contrib" />
			<src path="src/core" />
			<src path="src/eclipse" />
			<src path="src/javac" />
			<classpath location="build/lombok-pg" />
			<classpath refid="build.path" />
		</ivy:compile>
	</target>
	
	<!-- dist -->
	<target name="dist" description="Builds THE lombok-pg.jar file which contains everything." depends="compile">
		<mkdir dir="dist" />
		<jar destfile="dist/lombok-pg.jar">
			<fileset dir="build/lombok-pg" />
			<fileset dir="." includes="LICENSE" />
			<manifest>
				<attribute name="Premain-Class" value="lombok.core.Agent" />
				<attribute name="Agent-Class" value="lombok.core.Agent" />
				<attribute name="Can-Redefine-Classes" value="true" />
				<attribute name="Main-Class" value="lombok.core.Main" />
				<attribute name="Lombok-Version" value="0.10.0-BETA2-PG-HEAD" />
			</manifest>
		</jar>
		<property name="lombok.dist.built" value="true" />
	</target>
	
	<!-- resolve -->
	<target name="download-ipp" unless="ivyplusplus.available">
		<mkdir dir="lib" />
		<get src="http://projectlombok.org/downloads/ivyplusplus.jar" dest="lib/ivyplusplus.jar" usetimestamp="true" />
	</target>

	<target name="ensure-ipp" depends="download-ipp">
		<taskdef classpath="lib/ivyplusplus.jar" resource="com/zwitserloot/ivyplusplus/antlib.xml" uri="antlib:com.zwitserloot.ivyplusplus" />
	</target>

	<target name="config-ivy" depends="ensure-ipp">
		<ivy:configure file="buildScripts/ivysettings.xml" />
	</target>

	<target name="deps" depends="ensureBuildDeps, ensureRuntimeDeps, ensureTestDeps" />

	<target name="ensureBuildDeps" depends="config-ivy">
		<ivy:resolve file="buildScripts/ivy.xml" refresh="true" conf="build" />
		<ivy:retrieve />
	</target>

	<target name="ensureRuntimeDeps" depends="config-ivy">
		<ivy:resolve file="buildScripts/ivy.xml" refresh="true" conf="runtime" />
		<ivy:retrieve />
	</target>

	<target name="ensureTestDeps" depends="config-ivy">
		<ivy:resolve file="buildScripts/ivy.xml" refresh="true" conf="test" />
		<ivy:retrieve />
	</target>

	<target name="contrib" depends="config-ivy" description="Downloads various non-crucial documentation, sources, etc that are useful when developing lombok.ast.">
		<ivy:resolve file="buildScripts/ivy.xml" refresh="true" conf="contrib" />
		<ivy:retrieve />
	</target>

	<!-- IDE integration -->
	<target name="eclipse" depends="deps, contrib" description="Creates eclipse project files and downloads all dependencies. Open this directory as project in eclipse after running this target.">
		<ivy:eclipsegen source="1.6">
			<srcdir dir="src/core" />
			<srcdir dir="src/eclipse" />
			<srcdir dir="src/javac" />
			<srcdir dir="test/core" />
			<srcdir dir="test/eclipse" />
			<srcdir dir="test/javac" />
			<conf name="build" sources="contrib" />
			<conf name="test" sources="contrib" />
			<settings>
				<url url="http://cloud.github.com/downloads/peichhorn/lombok-pg/lombok.eclipse.settings" />
			</settings>
			<apt location="lib/build/spi.jar" />
		</ivy:eclipsegen>
	</target>

</project>
